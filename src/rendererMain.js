// This file is required by the index.html file and will
// be executed in the renderer process for that window.
// All of the Node.js APIs are available in this process.
var versionIdentifiers = {
    data : [
        {
            position: "01",
            filename: "Mili_pro_1.0.1.21.fw",
            file: null,
            identifierPosition: "24582",
            identifierSize: "8",
            identifierData: "312E302E312E3231",
            charTablePosition: "2882C",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "287EE",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "2898E",
            monthTableSize: "36",
            monthTableWidth: "3"
            
        }, {
            position: "02",
            filename: "Mili_pro_1.0.1.28.fw",
            file: null,
            identifierPosition: "2460E",
            identifierSize: "8",
            identifierData: "312E302E312E3238",
            charTablePosition: "288CC",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "2888E",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28A2E",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "03",
            filename: "Mili_pro_1.0.1.34.fw",
            file: null,
            identifierPosition: "2461A",
            identifierSize: "8",
            identifierData: "312E302E312E3334",
            charTablePosition: "288D8",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "2889A",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28A3A",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "04",
            filename: "Mili_pro_1.0.1.39.fw",
            file: null,
            identifierPosition: "2465A",
            identifierSize: "8",
            identifierData: "312E302E312E3339",
            charTablePosition: "28918",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "288DA",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28A7A",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "05",
            filename: "Mili_pro_1.0.1.47.fw",
            file: null,
            identifierPosition: "247DE",
            identifierSize: "8",
            identifierData: "312E302E312E3437",
            charTablePosition: "28A74",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28A36",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28BC6",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "06",
            filename: "Mili_pro_1.0.1.50.fw",
            file: null,
            identifierPosition: "24836",
            identifierSize: "8",
            identifierData: "312E302E312E3530",
            charTablePosition: "28ACC",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28A8E",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28C2E",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "07",
            filename: "Mili_pro_1.0.1.53.fw",
            file: null,
            identifierPosition: "24852",
            identifierSize: "8",
            identifierData: "312E302E312E3533",
            charTablePosition: "28AE8",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28AAA",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28C4A",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "08",
            filename: "Mili_pro_1.0.1.54.fw",
            file: null,
            identifierPosition: "249E1",
            identifierSize: "8",
            identifierData: "312E302E312E3534",
            charTablePosition: "28CB0",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28C72",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28E12",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "09",
            filename: "Mili_pro_1.0.1.59.fw",
            file: null,
            identifierPosition: "2562B",
            identifierSize: "8",
            identifierData: "312E302E312E3539",
            charTablePosition: "278B8",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "2787A",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27A1A",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "10",
            filename: "Mili_pro_1.0.1.67.fw",
            file: null,
            identifierPosition: "2560A",
            identifierSize: "8",
            identifierData: "312E302E312E3637",
            charTablePosition: "27A14",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "279D6",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27B76",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "11",
            filename: "Mili_pro_1.0.1.69.fw",
            file: null,
            identifierPosition: "25582",
            identifierSize: "8",
            identifierData: "312E302E312E3639",
            charTablePosition: "2798C",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "2794E",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27AEE",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "12",
            filename: "Mili_pro_1.0.1.81.fw",
            file: null,
            identifierPosition: "255F2",
            identifierSize: "8",
            identifierData: "312E302E312E3831",
            charTablePosition: "279FC",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "279BE",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27B5E",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "13",
            filename: "Mili_pro_i_1.0.1.49.fw",
            file: null,
            identifierPosition: "23684",
            identifierSize: "8",
            identifierData: "312E302E312E3439",
            charTablePosition: "27958",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "2791B",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27ABA",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "14",
            filename: "Mili_pro_i_1.0.1.52.fw",
            file: null,
            identifierPosition: "236A0",
            identifierSize: "8",
            identifierData: "312E302E312E3532",
            charTablePosition: "27974",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "27937",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27AD6",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "15",
            filename: "Mili_pro_tph_1.0.1.30.fw",
            file: null,
            identifierPosition: "246E4",
            identifierSize: "8",
            identifierData: "312E302E312E3330",
            charTablePosition: "289E0",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "289A3",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28B42",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "16",
            filename: "Mili_pro_tph_1.0.1.33.fw",
            file: null,
            identifierPosition: "24858",
            identifierSize: "8",
            identifierData: "312E302E312E3333",
            charTablePosition: "28B54",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28B17",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28CB6",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "17",
            filename: "Mili_pro_tph_1.0.1.47.fw",
            file: null,
            identifierPosition: "24914",
            identifierSize: "8",
            identifierData: "312E302E312E3437",
            charTablePosition: "28BE8",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28BAB",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28D4A",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "18",
            filename: "Mili_pro_tph_1.0.1.50.fw",
            file: null,
            identifierPosition: "2496C",
            identifierSize: "8",
            identifierData: "312E302E312E3530",
            charTablePosition: "28C40",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28C03",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28DA2",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "19",
            filename: "Mili_pro_tph_1.0.1.53.fw",
            file: null,
            identifierPosition: "24988",
            identifierSize: "8",
            identifierData: "312E302E312E3533",
            charTablePosition: "28C5C",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28C1F",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28DBE",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "20",
            filename: "Mili_pro_tph_1.0.1.67.fw",
            file: null,
            identifierPosition: "25374",
            identifierSize: "8",
            identifierData: "312E302E312E3637",
            charTablePosition: "277C4",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "27784",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27926",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "21",
            filename: "Mili_pro_tph_1.0.1.69.fw",
            file: null,
            identifierPosition: "252F0",
            identifierSize: "8",
            identifierData: "312E302E312E3639",
            charTablePosition: "27740",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "27700",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "278A2",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "22",
            filename: "Mili_pro_tph_1.0.1.81.fw",
            file: null,
            identifierPosition: "2573C",
            identifierSize: "8",
            identifierData: "312E302E312E3831",
            charTablePosition: "27B90",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "27B50",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27CF2",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "23",
            filename: "Mili_pro_tph_as7000_1.0.1.52.fw",
            file: null,
            identifierPosition: "23AD0",
            identifierSize: "8",
            identifierData: "312E302E312E3532",
            charTablePosition: "27DA4",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "27D67",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27F06",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "24",
            filename: "Mili_pro_tph_as7000_1.0.1.67.fw",
            file: null,
            identifierPosition: "2489C",
            identifierSize: "8",
            identifierData: "312E302E312E3637",
            charTablePosition: "26CEC",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "26CAC",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "26E4E",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "25",
            filename: "Mili_pro_tph_as7000_1.0.1.69.fw",
            file: null,
            identifierPosition: "24820",
            identifierSize: "8",
            identifierData: "312E302E312E3639",
            charTablePosition: "26C70",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "26C30",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "26DD2",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "26",
            filename: "Mili_pro_tph_as7000_1.0.1.81.fw",
            file: null,
            identifierPosition: "24888",
            identifierSize: "8",
            identifierData: "312E302E312E3831",
            charTablePosition: "26CDC",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "26C9C",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "26E3E",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "27",
            filename: "Mili_pro_tph_indian_1.0.1.58.fw",
            file: null,
            identifierPosition: "2469C",
            identifierSize: "8",
            identifierData: "312E302E312E3538",
            charTablePosition: "28970",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28933",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28AD2",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "28",
            filename: "Mili_pro_tph_indian_1.0.1.61.fw",
            file: null,
            identifierPosition: "249F0",
            identifierSize: "8",
            identifierData: "312E302E312E3631",
            charTablePosition: "28CC4",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28C87",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28E26",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "29",
            filename: "Mili_pro_tph_indian_1.0.1.69.fw",
            file: null,
            identifierPosition: "24984",
            identifierSize: "8",
            identifierData: "312E302E312E3639",
            charTablePosition: "28C58",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "28C1B",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "28DBA",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "30",
            filename: "Mili_pro_tph_indian_1.0.1.70.fw",
            file: null,
            identifierPosition: "256CC",
            identifierSize: "8",
            identifierData: "312E302E312E3730",
            charTablePosition: "27B1C",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "27ADC",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27C7E",
            monthTableSize: "36",
            monthTableWidth: "3"
        }, {
            position: "31",
            filename: "Mili_pro_tph_indian_1.0.1.81.fw",
            file: null,
            identifierPosition: "2573C",
            identifierSize: "8",
            identifierData: "312E302E312E3831",
            charTablePosition: "27B50",
            charTableSize: "216",
            charTableDataWidth: "8",
            dayTablePosition: "27B90",
            dayTableSize: "21",
            dayTableDataWidth: "3",
            monthTablePosition: "27CF2",
            monthTableSize: "36",
            monthTableWidth: "3"
        }
    ]
}

var characterTable = {
    char: [{
        position: "00",
        address: "28AAE",
        width: "05",
        defaultWidth: "05",
        representsChar: "a",
        charData: "C02020C0000102020102"
    }, {
        position: "01",
        address: "28C91",
        width: "04",
        defaultWidth: "04",
        representsChar: "b",
        charData: "FC2020C003020201"
    }, {
        position: "02",
        address: "28F32",
        width: "04",
        defaultWidth: "04",
        representsChar: "c",
        charData: "C020202001020202"
    }, {
        position: "03",
        address: "28C87",
        width: "05",
        defaultWidth: "05",
        representsChar: "d",
        charData: "C02020FC000102020102"
    }, {
        position: "04",
        address: "28E5C",
        width: "04",
        defaultWidth: "04",
        representsChar: "e",
        charData: "C0A0A0C001020202"
    }, {
        position: "05",
        address: "28E64",
        width: "04",
        defaultWidth: "04",
        representsChar: "g",
        charData: "C02020C00912120F"
    }, {
        position: "06",
        address: "28DFE",
        width: "04",
        defaultWidth: "04",
        representsChar: "h",
        charData: "FC2020C003000003"
    }, {
        position: "07",
        address: "28AAC",
        width: "01",
        defaultWidth: "01",
        representsChar: "i",
        charData: "E803"
    }, {
        position: "08",
        address: "28C5E",
        width: "01",
        defaultWidth: "01",
        representsChar: "l",
        charData: "FC03"
    }, {
        position: "09",
        address: "28DF6",
        width: "04",
        defaultWidth: "04",
        representsChar: "n",
        charData: "E02020C003000003"
    }, {
        position: "0A",
        address: "28E4C",
        width: "04",
        defaultWidth: "04",
        representsChar: "o",
        charData: "C02020C001020201"
    }, {
        position: "0B",
        address: "28C6A",
        width: "04",
        defaultWidth: "04",
        representsChar: "p",
        charData: "E02020C01F020201"
    }, {
        position: "0C",
        address: "28C56",
        width: "04",
        defaultWidth: "04",
        representsChar: "r",
        charData: "E040202003000000"
    }, {
        position: "0D",
        address: "28AB8",
        width: "04",
        defaultWidth: "04",
        representsChar: "t",
        charData: "20F0202000010202"
    }, {
        position: "0E",
        address: "28E42",
        width: "05",
        defaultWidth: "05",
        representsChar: "u",
        charData: "E00000E0000102020102"
    }, {
        position: "0F",
        address: "28C60",
        width: "05",
        defaultWidth: "05",
        representsChar: "v",
        charData: "60800080600001020100"
    }, {
        position: "10",
        address: "28E54",
        width: "04",
        defaultWidth: "04",
        representsChar: "y",
        charData: "E00000E00912120F"
    }, {
        position: "11",
        address: "28F48",
        width: "06",
        defaultWidth: "06",
        representsChar: "A",
        charData: "F048444448F0030000000003"
    }, {
        position: "12",
        address: "28E06",
        width: "06",
        defaultWidth: "06",
        representsChar: "D",
        charData: "FC04040408F0030202020100"
    }, {
        position: "13",
        address: "28DEC",
        width: "05",
        defaultWidth: "05",
        representsChar: "F",
        charData: "FC444444040300000000"
    }, {
        position: "14",
        address: "28C4C",
        width: "05",
        defaultWidth: "05",
        representsChar: "J",
        charData: "000404FC040102020100"
    }, {
        position: "15",
        address: "28F5E",
        width: "07",
        defaultWidth: "07",
        representsChar: "M",
        charData: "F80404F80404F803000003000003"
    }, {
        position: "16",
        address: "28CA3",
        width: "06",
        defaultWidth: "06",
        representsChar: "N",
        charData: "FC0C30C000FC030000000303"
    }, {
        position: "17",
        address: "28E36",
        width: "05",
        defaultWidth: "05",
        representsChar: "O",
        charData: "F8040404F80102020201"
    }, {
        position: "18",
        address: "28F54",
        width: "05",
        defaultWidth: "05",
        representsChar: "S",
        charData: "18242424C80102020201"
    }, {
        position: "19",
        address: "28C99",
        width: "05",
        defaultWidth: "05",
        representsChar: "T",
        charData: "0404FC04040000030000"
    }, {
        position: "1A",
        address: "28F3A",
        width: "07",
        defaultWidth: "07",
        representsChar: "W",
        charData: "FC0000FC0000FC01020201020201"
    }]
};

var dayOfWeekTable = {
    dayData: [{
        position: "00",
        dayText: "Monday",
        dayPos1: "15",
        dayPos2: "0A",
        dayPos3: "09"
    }, {
        position: "01",
        dayText: "Tuesday",
        dayPos1: "19",
        dayPos2: "0E",
        dayPos3: "04"
    }, {
        position: "02",
        dayText: "Wednesday",
        dayPos1: "1A",
        dayPos2: "04",
        dayPos3: "03"
    }, {
        position: "03",
        dayText: "Thursday",
        dayPos1: "19",
        dayPos2: "06",
        dayPos3: "0E"
    }, {
        position: "04",
        dayText: "Friday",
        dayPos1: "13",
        dayPos2: "0C",
        dayPos3: "07"
    }, {
        position: "05",
        dayText: "Saturday",
        dayPos1: "18",
        dayPos2: "00",
        dayPos3: "0D"
    }, {
        position: "06",
        dayText: "Sunday",
        dayPos1: "18",
        dayPos2: "0E",
        dayPos3: "09"
    }]
}

var monthTable = {
    monthData: [{
        position: "00",
        monthText: "January",
        monthPos1: "14",
        monthPos2: "00",
        monthPos3: "09"
    }, {
        position: "01",
        monthText: "February",
        monthPos1: "13",
        monthPos2: "04",
        monthPos3: "01"
    }, {
        position: "02",
        monthText: " March",
        monthPos1: "15",
        monthPos2: "00",
        monthPos3: "0C"
    }, {
        position: "03",
        monthText: "April",
        monthPos1: "11",
        monthPos2: "0B",
        monthPos3: "0C"
    }, {
        position: "04",
        monthText: "May",
        monthPos1: "15",
        monthPos2: "00",
        monthPos3: "10"
    }, {
        position: "05",
        monthText: "June",
        monthPos1: "14",
        monthPos2: "0E",
        monthPos3: "09"
    }, {
        position: "06",
        monthText: "July",
        monthPos1: "14",
        monthPos2: "0E",
        monthPos3: "08"
    }, {
        position: "07",
        monthText: "August",
        monthPos1: "11",
        monthPos2: "0E",
        monthPos3: "05"
    }, {
        position: "08",
        monthText: "September",
        monthPos1: "18",
        monthPos2: "04",
        monthPos3: "0B"
    }, {
        position: "09",
        monthText: "October",
        monthPos1: "17",
        monthPos2: "02",
        monthPos3: "0D"
    }, {
        position: "0A",
        monthText: "November",
        monthPos1: "16",
        monthPos2: "0A",
        monthPos3: "0F"
    }, {
        position: "0B",
        monthText: "December",
        monthPos1: "12",
        monthPos2: "04",
        monthPos3: "02"
    }]
}

var rawFirmware = null;

$(document).ready(() => {
    redrawTables();
});

function redrawTables() {
    displayCharacterTable();
    displayDayofWeekTable();
    displayMonthTable();
}

function displayCharacterTable() {
    var output = '<thead><tr><th scope="col">Pos.</th><th scope="col">Adr.</th><th scope="col">Width</th><th scope="col">Char.</th>';
        output += '<th scope="col">Edit</th>';
        //output += '<th scope="col">Reset</th></tr>';
        output += '</thead><tbody>';

    characterTable.char.forEach(charItem => {
        output += '<tr id="charItem_' + charItem.position + '"><th scope="row">0x' + charItem.position.toString(16) + '</th>';
        output += '<td>0x' + charItem.address.toString(16) + '</td><td>' + charItem.width.toString() + ' - ' + charItem.defaultWidth.toString() + '</td>';
        output += '<td><form class="form-inline"><input type="text" class="form-control" id="charInput" value="' + charItem.representsChar + '" style="width: 75px; height: 30px" maxlength="1"></form></td>';
        output += '<td><button type="button" class="btn btn-warning btn-sm" id="charItemEdit"><i class="fas fa-pen"></i></button></td>';
        //output += '<td><button type="button" class="btn btn-danger btn-sm" id="charItemUndo"><i class="fas fa-undo"></i></button></td>';
        output += '</tr>';
    });

    output += '</tbody>';

    $('#character-table').empty().append(output);
}

function displayDayofWeekTable() {
    var selectOptions = '';
    characterTable.char.forEach(charItem => {
        selectOptions += '<option value="' + charItem.position + '">' + charItem.position + '</option>';
    });

    var output = '<thead><tr><th scope="col">Day</th><th scope="col">Pos. 1</th><th scope="col">Pos. 2</th><th scope="col">Pos. 3</th><th scope="col">Result</th></tr></thead><tbody>';

    dayOfWeekTable.dayData.forEach(dayItem => {
        output += '<tr id="dayItem_' + dayItem.position + '"><th scope="row">' + dayItem.dayText + '</th>';

        output += '<td><select class="form-control form-control-sm dayItemPos" style="height: 30px; width: 80px;" id="dayItemPos_1">';
        output += generateCharPositionsOptionText(dayItem.dayPos1) + '</select></td>';

        output += '<td><select class="form-control form-control-sm dayItemPos" style="height: 30px; width: 80px;" id="dayItemPos_2">';
        output += generateCharPositionsOptionText(dayItem.dayPos2) + '</select></td>';

        output += '<td><select class="form-control form-control-sm dayItemPos" style="height: 30px; width: 80px;" id="dayItemPos_3">';
        output += generateCharPositionsOptionText(dayItem.dayPos3) + '</select></td>';

        output += '<td>' + generateStringFromCharPos(dayItem.dayPos1, dayItem.dayPos2, dayItem.dayPos3) + '</td></tr>';
    });

    output += '</tbody>';

    $('#day-of-week-table').empty().append(output);
}

function displayMonthTable() {
    var selectOptions = '';
    characterTable.char.forEach(charItem => {
        selectOptions += '<option value="' + charItem.position + '">' + charItem.position + '</option>';
    });

    var output = '<thead><tr><th scope="col">Month</th><th scope="col">Pos. 1</th><th scope="col">Pos. 2</th><th scope="col">Pos. 3</th><th scope="col">Result</th></tr></thead><tbody>';

    monthTable.monthData.forEach(monthItem => {
        output += '<tr id="monthItem_' + monthItem.position + '"><th scope="row">' + monthItem.
        monthText + '</th>';

        output += '<td><select class="form-control form-control-sm monthItemPos" style="height: 30px; width: 80px;" id="monthItemPos_1">';
        output += generateCharPositionsOptionText(monthItem.monthPos1) + '</select></td>';

        output += '<td><select class="form-control form-control-sm monthItemPos" style="height: 30px; width: 80px;" id="monthItemPos_2">';
        output += generateCharPositionsOptionText(monthItem.monthPos2) + '</select></td>';

        output += '<td><select class="form-control form-control-sm monthItemPos" style="height: 30px; width: 80px;" id="monthItemPos_3">';
        output += generateCharPositionsOptionText(monthItem.monthPos3) + '</select></td>';

        output += '<td>' + generateStringFromCharPos(monthItem.monthPos1, monthItem.monthPos2, monthItem.monthPos3) + '</td></tr>';
    });

    output += '</tbody>';

    $('#month-table').empty().append(output);
}

function generateStringFromCharPos(pos1, pos2, pos3) {
    var output = characterTable.char[parseInt(pos1, 16)].representsChar + characterTable.char[parseInt(pos2, 16)].representsChar + characterTable.char[parseInt(pos3, 16)].representsChar;
    
    return output;
}

function generateCharPositionsOptionText(selectedPosition) {
    var selectOptions = '';

    characterTable.char.forEach(charItem => {
        if (charItem.position == selectedPosition) {
            selectOptions += '<option value="' + charItem.position + '" selected>' + charItem.position + '</option>';
        } else {
            selectOptions += '<option value="' + charItem.position + '">' + charItem.position + '</option>';
        }
    });

    return selectOptions;
};

$('#but_loadFirmware').click(() => {
    ipcRenderer.sendSync('openFirmwareDialog', '')
})

$('#but_saveFirmware').click(() => {
    saveDataToFirmware();

    // console.log(rawFirmware.data); // DEV
    ipcRenderer.sendSync('save-firmware', JSON.stringify(rawFirmware.data))
})

$('#but_loadTableData').click(() => {
    ipcRenderer.sendSync('load-table-data', "");
})

$('#but_saveTableData').click(() => {
    var output = {dataChar: characterTable, dataDay: dayOfWeekTable, dataMonth: monthTable};
    output = JSON.stringify(output);
    // console.log(output); // DEV
    ipcRenderer.sendSync('save-table-data', output);
})

$(document).on('change', '#charInput', function() {
    // Get the Position of the charItem by reading the table row's ID: charItem_xx
    var charItemPos = $(this).parent().parent().parent().attr('id').replace('charItem_', '');

    // Read the new Value for the character representation
    var charItemValue = $(this).val();

    // Write the new char into the characterTable
    characterTable.char[parseInt(charItemPos, 16)].representsChar = charItemValue;

    redrawTables();
})

$(document).on('change', '.dayItemPos', function() {
    // Get the Position of the dayItem by reading the table row's ID: dayItem_xx
    var dayItemPos = $(this).parent().parent().attr('id').replace('dayItem_', '');

    // Read the position (1, 2 or 3) of the changed char by reading it's ID: dayItemPos_x
    var dayItemCharPos = $(this).attr('id').replace('dayItemPos_', '');
    // Read the new Character by reading the input's value
    var dayItemChar = $(this).val();

    // Write the new char into the dayOfWeekTable
    switch(dayItemCharPos) {
        case "1":
            dayOfWeekTable.dayData[parseInt(dayItemPos, 16)].dayPos1 = dayItemChar;
            break;
        case "2":
            dayOfWeekTable.dayData[parseInt(dayItemPos, 16)].dayPos2 = dayItemChar;
            break;
        case "3":
            dayOfWeekTable.dayData[parseInt(dayItemPos, 16)].dayPos3 = dayItemChar;
            break;
    }

    redrawTables();
})

$(document).on('change', '.monthItemPos', function() {
    // Get the Position of the monthItem by reading the table row's ID: monthItem_xx
    var monthItemPos = $(this).parent().parent().attr('id').replace('monthItem_', '');

    // Read the position (1, 2 or 3) of the changed char by reading it's ID: monthItemPos_x
    var monthItemCharPos = $(this).attr('id').replace('monthItemPos_', '');
    // Read the new Character by reading the input's value
    var monthItemChar = $(this).val();

    // Write the new char into the monthOfWeekTable
    switch(monthItemCharPos) {
        case "1":
            monthTable.monthData[parseInt(monthItemPos, 16)].monthPos1 = monthItemChar;
            break;
        case "2":
            monthTable.monthData[parseInt(monthItemPos, 16)].monthPos2 = monthItemChar;
            break;
        case "3":
            monthTable.monthData[parseInt(monthItemPos, 16)].monthPos3 = monthItemChar;
            break;
    }

    redrawTables();
})

$(document).on('click', '#charItemEdit', function() {
    var charPos = $(this).parent().parent().attr('id').replace('charItem_', '');
    // console.log(charPos);  // DEV
    ipcRenderer.sendSync('openEditor', characterTable.char[parseInt(charPos, 16)]);
})

// ipc-main: sending messages
// In renderer process (web page).
const ipcRenderer = require('electron').ipcRenderer

ipcRenderer.on('saved-char-data', function (event, arg) {
    // console.log(arg); // DEV
    // console.log("index: " + parseInt(arg.position, 16).toString(16) + " | old value: " + characterTable.char[parseInt(arg.position, 16)].charData + " | new value: " + arg.charData); // DEV
    characterTable.char[parseInt(arg.position, 16)].charData = arg.charData;
    characterTable.char[parseInt(arg.position, 16)].width = arg.width;
    redrawTables();
});

ipcRenderer.on('opened-firmware-data', function (event, arg) {
    rawFirmware = {data: arg, versionIndex: -1};
    //console.log(rawFirmware) // prints result of firmware open dialog
    
    // Go through every versionData
    var versionIndex = -1;
    for(var i = 0; i != versionIdentifiers.data.length; i++) {
        var comparePattern = versionIdentifiers.data[i].identifierData;
        var comparePatternLength = parseInt(versionIdentifiers.data[i].identifierSize, 16);
        var comparePosition = parseInt(versionIdentifiers.data[i].identifierPosition, 16);

        // First, read in the data of the file, with the length of what we search
        var fileData = "";
        //console.log("pattern start offset: 0x" + comparePosition.toString(16) + " | pattern end offset: 0x" + (comparePosition + comparePatternLength).toString(16) + " | file size: 0x" + rawFirmware.data.length.toString(16));
        for(var dataByte = comparePosition; dataByte != (comparePosition + comparePatternLength); dataByte++) {
            //console.log(dataByte + " " + comparePatternLength);
            var tempDataChar = (rawFirmware.data.readUInt8(dataByte)).toString(16);
            if (tempDataChar.length == 1) tempDataChar = "0" + tempDataChar;
    
            fileData += tempDataChar;
        }
        fileData = fileData.toUpperCase();

        // Then, compare if the data and the read in data is the same
        if( comparePattern == fileData) {
            versionIndex = i;
            rawFirmware = {data: rawFirmware.data, versionIndex: i};
        }
    }
    if (versionIndex != -1) {
        // console.log("Version Filename: " + versionIdentifiers.data[versionIndex].filename); // DEV
        // console.log(rawFirmware); // DEV
    } else {
        //  console.log("No Version found :("); // DEV
    }

    loadDataFromFirmware();
});

ipcRenderer.on('loaded-table-data', function (event, arg) {
    var rawTableData = JSON.parse(arg);
    //console.log(rawTableData);

    // Load in characterTable Data
    for(var i = 0; i != rawTableData.dataChar.char.length; i++) {
        var newData = rawTableData.dataChar.char[i];

        characterTable.char[i].charData = newData.charData;
        characterTable.char[i].width = newData.width;
        characterTable.char[i].representsChar = newData.representsChar;
    }

    // Load in dayOfWeekTable Data
    for(var i = 0; i != rawTableData.dataDay.dayData.length; i++) {
        // console.log("dayData: " + i); // DEV
    }

    redrawTables();
});

function loadDataFromFirmware() {
    // Test if this is the indian version
    var thisVersion = versionIdentifiers.data[rawFirmware.versionIndex];

    if (thisVersion.filename.substring(0, 14) == "Mili_pro_tph_1" || thisVersion.filename.substring(0, 20) == "Mili_pro_tph_indian_") {
        console.log("TPH!");
        //console.log("")
        //dataPosition = (parseInt(dataPosition, 16) - 0x8006000).toString(16);
        alert('Sorry! Sadly, this program cannot edit the date strings of the firmware files "Mili_pro_tph" or "Mili_pro_tph_indian" :(');
        ipcRenderer.sendSync('close-app', '')
    }


    // First load char table
    
    var thisBuffer = rawFirmware.data;

    var charTableData = [];

    for(var charIndex = 0; charIndex != (characterTable.char.length * 8); charIndex += 8) {
        var charOrigIndex = charIndex / 8

        //
        // read 4 bytes in for character data position
        //
        var dataPosition = "";
        for(var offset = (charIndex + 3); offset != (charIndex - 1); offset--) {
            // console.log("index: " + charIndex + " | offset: " + offset); // DEV
            dataPosition += bufferPartToHexString(thisBuffer, (parseInt(thisVersion.charTablePosition, 16) + offset), 1)
        }
        // console.log("char: " + characterTable.char[charOrigIndex].representsChar + " | position: " + dataPosition); // DEV
        dataPosition = (parseInt(dataPosition, 16) - 0x8004000).toString(16);
        
        
        dataPosition = dataPosition.toUpperCase();
        // console.log("dataPosition: 0x" + dataPosition) // DEV

        characterTable.char[charOrigIndex].address = dataPosition;
        
        // Read in character width (5.th byte)
        var charWidth = bufferPartToHexString(thisBuffer, (parseInt(thisVersion.charTablePosition, 16) + charIndex + 4), 1)
        characterTable.char[charOrigIndex].width = charWidth;
        //
        // read in the character data
        //
        
        var charPosition = parseInt(characterTable.char[charOrigIndex].address, 16)
        var charLength = parseInt(characterTable.char[charOrigIndex].width) * 2;
        //console.log(charPosition.toString(16) + " | " + charLength)

        var charBinaryData = bufferPartToHexString(thisBuffer, charPosition, charLength);
        charBinaryData = charBinaryData.toUpperCase();

        characterTable.char[charOrigIndex].charData = charBinaryData;
       // console.log("character: " + characterTable.char[charOrigIndex].representsChar + " | length: " + charLength + " | charBinaryData: 0x" + charBinaryData)


    }

    //Then, load day of week table
    var dayPosition = parseInt(thisVersion.dayTablePosition, 16);
    for(var dayIndex = 0; dayIndex != (dayOfWeekTable.dayData.length * 3); dayIndex += 3) {
        var dayOrigIndex = dayIndex / 3

        dayOfWeekTable.dayData[dayOrigIndex].dayPos1 = bufferPartToHexString(thisBuffer, dayPosition + dayIndex, 1).toUpperCase();
        dayOfWeekTable.dayData[dayOrigIndex].dayPos2 = bufferPartToHexString(thisBuffer, dayPosition + dayIndex + 1, 1).toUpperCase();
        dayOfWeekTable.dayData[dayOrigIndex].dayPos3 = bufferPartToHexString(thisBuffer, dayPosition + dayIndex + 2, 1).toUpperCase();
        
        // console.log(dayOfWeekTable.dayData[dayOrigIndex].dayText + " | " + dayOfWeekTable.dayData[dayOrigIndex].dayPos1 + " | " + dayOfWeekTable.dayData[dayOrigIndex].dayPos2 + " | " + dayOfWeekTable.dayData[dayOrigIndex].dayPos3) // DEV
    }

    //Then, load month table
    var monthPosition = parseInt(thisVersion.monthTablePosition, 16);
    for(var monthIndex = 0; monthIndex != (monthTable.monthData.length * 3); monthIndex += 3) {
        var monthOrigIndex = monthIndex / 3

        monthTable.monthData[monthOrigIndex].monthPos1 = bufferPartToHexString(thisBuffer, monthPosition + monthIndex, 1).toUpperCase();
        monthTable.monthData[monthOrigIndex].monthPos2 = bufferPartToHexString(thisBuffer, monthPosition + monthIndex + 1, 1).toUpperCase();
        monthTable.monthData[monthOrigIndex].monthPos3 = bufferPartToHexString(thisBuffer, monthPosition + monthIndex + 2, 1).toUpperCase();

        // console.log(monthTable.monthData[monthOrigIndex].monthText + " | " + monthTable.monthData[monthOrigIndex].monthPos1 + " | " + monthTable.monthData[monthOrigIndex].monthPos2 + " | " + monthTable.monthData[monthOrigIndex].monthPos3) // DEV

    }

    redrawTables();

}

function saveDataToFirmware() {
    // Save char widths

    var thisVersion = versionIdentifiers.data[rawFirmware.versionIndex];

    for(var charIndex = 0; charIndex != (characterTable.char.length * 8); charIndex += 8) {
        var charOrigIndex = charIndex / 8
        
        // Write the character width (5.th byte)
        var charWidth = parseInt(characterTable.char[charOrigIndex].width, 10);
        var offset = parseInt(thisVersion.charTablePosition, 16) + charIndex + 4;
        rawFirmware.data.writeUInt8(charWidth, offset);
    }
    // First, save all charItems
    for(var i = 0; i != characterTable.char.length; i++) {
        
        var thisChar = characterTable.char[i];

        // console.log(thisChar.representsChar); // DEV

        // Write char data
        var dataBuffer = thisChar.charData;
        for(var offset = parseInt(thisChar.address, 16); offset != (parseInt(thisChar.address, 16) + (parseInt(thisChar.width, 16) * 2)); offset++) {
            var byte = dataBuffer.substring(0, 2);
            dataBuffer = dataBuffer.substring(2);

            byte = parseInt(byte, 16);

            rawFirmware.data.writeUInt8(byte, offset);

            // console.log("offset: 0x" + offset.toString(16) + " | data: 0x" + byte.toString(16)); // DEV
        }
    }

    // Then, save all the dayOfWeekItems
    var dayItemData = "";
    for(var i = 0; i != dayOfWeekTable.dayData.length; i++) {
        var dayPos1 = dayOfWeekTable.dayData[i].dayPos1;
        var dayPos2 = dayOfWeekTable.dayData[i].dayPos2;
        var dayPos3 = dayOfWeekTable.dayData[i].dayPos3;
        dayItemData += dayPos1 + dayPos2 + dayPos3;
        // console.log("index: " + i.toString() + " | dayPos1: " + dayPos1.toString(16) + " | dayPos2: " + dayPos2.toString(16) + " | dayPos3: " + dayPos3.toString(16)) // DEV
    }
    var dayOffset = parseInt(thisVersion.dayTablePosition, 16);
    var dayLength = parseInt(thisVersion.dayTableSize);

    for(var i = dayOffset; i != (dayOffset + dayLength); i++) {
        var byte = dayItemData.substring(0, 2);
        dayItemData = dayItemData.substring(2);
        byte = parseInt(byte, 16);

        rawFirmware.data.writeUInt8(byte, i);
        // console.log("offset: 0x" + i.toString(16) + " | data: 0x" + byte.toString(16)); // DEV
    }

    // Then, save all the monthItems
    var monthItemData = "";
    for(var i = 0; i != monthTable.monthData.length; i++) {
        var monthPos1 = monthTable.monthData[i].monthPos1;
        var monthPos2 = monthTable.monthData[i].monthPos2;
        var monthPos3 = monthTable.monthData[i].monthPos3;
        monthItemData += monthPos1 + monthPos2 + monthPos3;
        // console.log("index: " + i.toString() + " | monthPos1: " + monthPos1.toString(16) + " | monthPos2: " + monthPos2.toString(16) + " | monthPos3: " + monthPos3.toString(16))  // DEV
    }
    var thisVersion = versionIdentifiers.data[rawFirmware.versionIndex];
    var monthOffset = parseInt(thisVersion.monthTablePosition, 16);
    var monthLength = parseInt(thisVersion.monthTableSize);

    for(var i = monthOffset; i != (monthOffset + monthLength); i++) {
        var byte = monthItemData.substring(0, 2);
        monthItemData = monthItemData.substring(2);
        byte = parseInt(byte, 16);

        rawFirmware.data.writeUInt8(byte, i);
        // console.log("offset: 0x" + i.toString(16) + " | data: 0x" + byte.toString(16)); // DEV
    }



}

function bufferPartToHexString(buffer, startPos, length) {
    // First, read in the data of the file, with the length of what we search
    var output = "";
    for(var dataByte = startPos; dataByte != (startPos + length); dataByte++) {
        //console.log(dataByte + " " + comparePatternLength);
        var tempDataChar = (buffer.readUInt8(dataByte)).toString(16);
        if (tempDataChar.length == 1) tempDataChar = "0" + tempDataChar;

        output += tempDataChar;
    }

    return output;
}

$('#window-minimize').click(() => {
    ipcRenderer.sendSync('window-minimize', '');
})

$(document).on('click', '#window-maximize', () => {
    var response = ipcRenderer.sendSync('window-maximize', '');
    // console.log(response); // DEV
    var output = '';
    if (response.status == true) {
        output = '<i class="far fa-window-maximize navbarIcon" id="window-maximize">';
    } else {
        output = '<i class="fas fa-window-maximize navbarIcon" id="window-maximize">';
    }
    // console.log(output); // DEV
    $('#window-maximize-a').empty().append(output);
})

$('#window-close').click(() => {
    ipcRenderer.sendSync('window-close', '');
})

$(document).scroll(function() {
    setBodyScrollShadow();
})

function setBodyScrollShadow() {

}